<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="description" content="Piano Test by Michael Anthony Abia">
        <title>Piano Test</title>
        <style>
            body{
                background: #000000;
            }
            #grid {
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(1px, 1fr));
              grid-gap: 0.6vw;
              height: 90vh;
              overflow: hidden;
            }
            #grid > div {
              font-size: 4vw;
              padding-top: 5vh;
              color: #EEEEDD;
              background: #FFFFEE;
              border-radius: 3px;
              text-align: center;
              overflow: hidden;
              user-select: none;
                -webkit-user-select: none;
                -moz-user-select: none;
            }
            #grid div:active {
                background: #EEEEDD;
            }
        </style>
    </head>
    <body>
        <div id="grid">
            <!-- 3rd Octave -->
            <div ontouchstart="playnote(130.813)" onmousedown="playnote(130.813)">C</div>
            <div ontouchstart="playnote(146.832)" onmousedown="playnote(146.832)">D</div>
            <div ontouchstart="playnote(164.814)" onmousedown="playnote(164.814)">E</div>
            <div ontouchstart="playnote(174.614)" onmousedown="playnote(174.614)">F</div>
            <div ontouchstart="playnote(195.998)" onmousedown="playnote(195.998)">G</div>
            <div ontouchstart="playnote(220.000)" onmousedown="playnote(220.000)">A</div>
            <div ontouchstart="playnote(246.942)" onmousedown="playnote(246.942)">B</div>
            <!-- 4th Octave -->
            <div ontouchstart="playnote(261.626)" onmousedown="playnote(261.626)">C</div>
            <div ontouchstart="playnote(293.665)" onmousedown="playnote(293.665)">D</div>
            <div ontouchstart="playnote(329.628)" onmousedown="playnote(329.628)">E</div>
            <div ontouchstart="playnote(349.228)" onmousedown="playnote(349.228)">F</div>
            <div ontouchstart="playnote(391.995)" onmousedown="playnote(391.995)">G</div>
            <div ontouchstart="playnote(440.000)" onmousedown="playnote(440.000)">A</div>
            <div ontouchstart="playnote(493.883)" onmousedown="playnote(493.883)">B</div>
            <!-- 5th Octave -->
            <div ontouchstart="playnote(523.251)" onmousedown="playnote(523.251)">C</div>
            <div ontouchstart="playnote(587.330)" onmousedown="playnote(587.330)">D</div>
            <div ontouchstart="playnote(659.255)" onmousedown="playnote(659.255)">E</div>
            <div ontouchstart="playnote(698.456)" onmousedown="playnote(698.456)">F</div>
            <div ontouchstart="playnote(783.991)" onmousedown="playnote(783.991)">G</div>
            <div ontouchstart="playnote(880.000)" onmousedown="playnote(880.000)">A</div>
            <div ontouchstart="playnote(987.767)" onmousedown="playnote(987.767)">B</div>
        </div>
        <script>
            var soundevice = new (window.AudioContext || window.webkitAudioContext || window.audioContext);
            var amplitude = 0.3;
            var duration = 3800;

            var playnote = (pitch, callback) => {

                var oscillator = soundevice.createOscillator();
                var gainNode = soundevice.createGain();

                gainNode.connect(soundevice.destination);
                gainNode.gain.value = amplitude;
                gainNode.gain.cancelScheduledValues(soundevice.currentTime);
                gainNode.gain.setValueAtTime(0.0001, soundevice.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(amplitude, soundevice.currentTime + 0.1); //attack
                gainNode.gain.exponentialRampToValueAtTime(amplitude-(amplitude/2), soundevice.currentTime + 0.1 + 0.15); //decay
                gainNode.gain.exponentialRampToValueAtTime(0.0001, soundevice.currentTime + 0.1 + 0.15 + 1.5); //release
                oscillator.connect(gainNode);
                oscillator.type = "sine";
                oscillator.frequency.value = pitch;

                if (callback){
                    oscillator.onended = callback;
                }
                
                oscillator.start(soundevice.currentTime);
                oscillator.stop(soundevice.currentTime + ((duration || 500) / 1000));
            };
        </script>
    </body>
</html>
